<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/>
    <title>LOGIN FINAL</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>

    <script>
        async function fazerLogin() {
            console.log("1. Botão clicado!");
            
            const user = document.getElementById("UserName").value;
            const pass = document.getElementById("Password").value;

            console.log("2. Dados pegos:", user, pass);

            if (!user || !pass) {
                alert("⚠️ Preencha tudo!");
                return;
            }

            try {
                console.log("3. Enviando para PORTA 40000...");
                
                // --- CORREÇÃO AQUI ---
                // Adicionei a URL completa da porta 40000
                const resp = await axios.post('http://localhost:40000/Login', {
                    UserName: user,
                    Password: pass
                }, {
                    headers: { 'Content-Type': 'application/json' }
                });
                // ---------------------

                // O seu backend retorna { auth: true, token: ... }
                // Então verificamos se auth é true
                if (resp.data.auth) {
                    alert("✅ SUCESSO!");
                    
                    // Salva o token se existir
                    if(resp.data.token) {
                        localStorage.setItem('token', resp.data.token);
                    }

                    Cookies.set('isLogged', true);
                    window.location.href = "/";
                } else {
                    alert("❌ Falha: " + (resp.data.message || "Login inválido"));
                }

            } catch (error) {
                console.error(error);
                // Tenta pegar a mensagem exata do backend
                const msgErro = error.response?.data?.message || error.message;
                alert("❌ Erro Técnico: " + msgErro);
            }
        }
    </script>
</head>
<body class="bg-primary d-flex align-items-center justify-content-center vh-100">

    <div class="card shadow-lg" style="width: 400px;">
        <div class="card-header text-center">
            <h3>PetCare Login</h3>
        </div>
        <div class="card-body">
            <form onsubmit="event.preventDefault();">
                <div class="mb-3">
                    <label>Usuário</label>
                    <input class="form-control" id="UserName" type="text" />
                </div>
                <div class="mb-3">
                    <label>Senha</label>
                    <input class="form-control" id="Password" type="password" />
                </div>
                <div class="d-grid">
                    <button type="button" class="btn btn-dark" onclick="fazerLogin()">ENTRAR</button>
                </div>
            </form>
        </div>
    </div>

</body>
</html>